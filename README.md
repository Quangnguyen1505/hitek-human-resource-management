# 📌 Human Resource Management
### [🇻🇳 <u>Vietnamese</u>](README_VI.md)
## 🚀 Introduction

The Human Resource Management project helps administrators manage employees efficiently. The project is built with TypeScript, Node.js, Express, and MongoDB, integrating the Singleton Pattern for database initialization. Additionally, Docker and Docker Compose are used for building and deploying the system.

## Development Environment Information

- Node.js: v20.17.0
- Package Manager: npm 10.8.2
- Express: v5.0.1
- MongoDB: 4.4 (Dockerized)
- Docker: 27.3.1, Docker Compose: v2.30.3-desktop.1

## 📂 Project Structure

```
/hitek-human-resource-management
│── docs/
│   ├── images/         # API test images
│       ├── authentication
│       ├── employee
│── src/                # Main source code
│   ├── config/         # Configuration files
│   ├── controllers/    # Request handling
│   ├── core/           # Response and error handling
│   ├── db/             # MongoDB connection (Singleton Pattern)
│   ├── middlewares/    # Common middlewares
│   ├── models/         # Mongoose data models
│   ├── repository/     # Data queries
│   ├── routes/         # API routes
│   ├── services/       # Business logic
│   ├── utils/          # General utilities
│   ├── app.ts          # Express app initialization
│   ├── index.ts        # Server startup
│── .dockerignore               # Ignore files when building Docker
│── .editorconfig               # Code formatting rules for Editor
│── .env                        # Environment variables
│── .env.example                # Sample .env file for configuration guidance
│── .gitignore                  # Ignore files when committing to Git
│── .prettierrc                 # Prettier configuration for code formatting
│── docker-compose.yml          # Docker Compose configuration
│── Dockerfile                  # Docker image packaging
│── eslint.config.mjs           # ESLint configuration
│── nodemon.json                # Nodemon configuration for auto-reloading
│── package-lock.json           # Dependency version lock
│── package.json                # Project dependencies and scripts
│── README.md                   # Project documentation
│── tsconfig.json               # TypeScript settings
```

## 📌 Database Structure

### 🗝️ **Table `keys`** (Stores security keys)

| Field               | Data Type               | Required | Description                                   |
| ------------------- | ---------------------- | -------- | --------------------------------------------- |
| `_id`               | `ObjectId`             | ✅       | Key ID (auto-generated by MongoDB)           |
| `user`              | `ObjectId (ref: Shop)` | ✅       | Shop ID linked to this key                   |
| `privateKey`        | `String`               | ✅       | Private key                                  |
| `publicKey`         | `String`               | ✅       | Public key                                   |
| `refreshTokensUsed` | `Array<String>`        | ❌       | List of used refresh tokens                  |
| `refreshToken`      | `String`               | ✅       | Current refresh token                        |
| `createdAt`         | `Date`                 | ✅       | Creation time (auto-generated)               |
| `updatedAt`         | `Date`                 | ✅       | Update time (auto-generated)                 |

---

### 👤 **Table `employees`** (Stores employee information)

| Field      | Data Type                   | Required | Description                                  |
| ----------- | ---------------------------- | -------- | -------------------------------------------- |
| `_id`       | `ObjectId`                   | ✅       | Employee ID (auto-generated by MongoDB)      |
| `username`  | `String (unique)`            | ✅       | Unique login name                            |
| `fullname`  | `String`                     | ❌       | Full name                                    |
| `password`  | `String`                     | ✅       | Hashed password                              |
| `avatar`    | `String`                     | ❌       | Profile picture                              |
| `status`    | `Enum('active', 'deactive')` | ✅       | Account status (default: `active`)           |
| `createdAt` | `Date`                       | ✅       | Creation time (auto-generated)               |
| `updatedAt` | `Date`                       | ✅       | Update time (auto-generated)                 |

## 📌 API List

### 🛠️ **Authentication**

| Method   | Endpoint                            | Description                                                                                                                    | Requires Header |
| -------- | ----------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ | -------------- |
| `POST`   | `/api/v1/auth/register`             | Register a new account                                                                                                         | ❌             |
| `POST`   | `/api/v1/auth/login`                | Login                                                                                                                          | ❌             |
| `POST`   | `/api/v1/auth/change-password`      | Change password                                                                                                               | ✅             |
| `POST`   | `/api/v1/auth/handler-refreshToken` | Handle refresh token to issue a new access token when the current one expires, ensuring security against token reuse attacks. | ✅             |

---

### 👤 **Employees**

| Method   | Endpoint                | Description                     | Requires Header |
| -------- | ----------------------- | ------------------------------- | -------------- |
| `GET`    | `/api/v1/employees`     | Get employee list               | ✅             |
| `GET`    | `/api/v1/employees/:id` | Get employee details by ID      | ✅             |
| `PUT`    | `/api/v1/employees`     | Update employee information     | ✅             |
| `DELETE` | `/api/v1/employees/:id` | Delete an employee              | ✅             |

### 📌 API Header Parameters
```sh
x-client-id: <userId>
authorization: <accessToken>
x-rtoken-id: <refreshToken>
```
**Only `/api/v1/auth/handler-refreshToken` requires `x-client-id`, `authorization`, `x-rtoken-id`.**
**Other APIs that require Header require `x-client-id`, `authorization`.**

# 📸 API Test (Test API)

To test your project's APIs, you can use **Postman**.

## Use Postman

### 🔐 **Authentication**

**1. Register**

**Request Body:**
 ![Request Body](./docs/images/authentication/registerBody.png)

**Response:**
 ![Response](./docs/images/authentication/registerResult.png)

**2. Login**

**Request Body:**
 ![Request Body](./docs/images/authentication/loginBody.png)

**Response:**
 ![Response](./docs/images/authentication/loginResult.png)

**3. Change password**

**Request Body and Response:**
 ![Request Body and Response](./docs/images/authentication/changePassword.png)

**4. Handle Refresh Token**

**Request Header:**
 ![Request Header](./docs/images/authentication/handleRfTokenHeader.png)

**Response:**
 ![Response](./docs/images/authentication/handleRfTokenResult.png)

**Error if reusing Token:**
![reusing Token](./docs/images/authentication/handleRfTokenAgian.png)

---

**👥 Employees**

**5. Get employees by Id**

**Request Header and Response:**
 ![Request Header and Response](./docs/images/employee/getOne.png)

**6. Get all employees**

**Request Header:**
 ![Request Header](./docs/images/employee/getallHeader.png)

**Response:**
 ![Response](./docs/images/employee/getAllResult.png)

**7. Update employees**

**Request Header:**
 ![Request Body](./docs/images/employee/updateHeader.png)

**Body and Response:**
 ![Response](./docs/images/employee/updateBodyandResult.png)

**8. Delete employees**

![Delete](./docs/images/employee/delete.png)

## How to use (build and deploy)

1. **Clone repo**

2. **Install Docker and Docker Compose**

### Run with Docker

3. **Add .env file as in env.example**

4. **Build and run container**

```sh
docker-compose up --build -d
```

4. **Test container**

```sh
docker ps
```

5. **Access API**

```sh
Example:
http://localhost:3000/api/employees (Note: this api requires header(x-client-id, authorization) from login)
```

6. **Stop container**

```sh
docker-compose down
```

## Singleton Pattern in MongoDB initialization

The project applies Singleton Pattern in connecting MongoDB to avoid creating many unnecessary connections

## Features

### Done:

- [x] Personnel management (View all, view details, delete, edit personnel)
- [x] Authentication (Register, login, change password)
- [x] Encrypt Password with salt before saving to database
- [x] Create database indexes (username, status) optimized for querying
- [x] JWT authentication protects the router and creates JWT using symmetric algorithm, in addition to issuing new Token pairs when expired and preventing token reuse attacks
- [x] Error handling (Success, Failure, Exception)
- [x] Check input parameters
- [x] Connect MongoDB according to Singleton Pattern
- [x] Dockerized backend + MongoDB using docker and docker-compose

### Not done: None
